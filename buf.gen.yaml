version: v1
managed:
  enabled: true
plugins:
  # TypeScript generation
  - plugin: buf.build/community/stephenh-ts-proto
    out: autogenerated/ts
    opt:
      - env=browser
      - outputClientImpl=grpc-web
      - useOptionals=messages
      - useExactTypes=true
      - exportCommonSymbols=true
      - onlyTypes=false
      - esModuleInterop=true
      - stringEnums=true
      - addGrpcMetadata=true
      - forceLong=string
      - outputJsonMethods=true
      - outputEncodeMethods=true
      - includeCommonJs=true
      - generateWellKnownTypes=true

  - plugin: buf.build/community/neoeinstein-prost
    out: autogenerated/rust/src
    opt:
      - bytes=bytes
      - file_descriptor_set=true
      - compile_well_known_types
      - extern_path=.google.protobuf=::prost_types
 
  - plugin: buf.build/community/neoeinstein-tonic
    out: autogenerated/rust/src
    opt:
      - compile_well_known_types
      - extern_path=.google.protobuf=::prost_types

  - plugin: prost-crate
    strategy: all
    out: autogenerated/rust
    opt:
      - gen_crate=proto/Cargo.toml

